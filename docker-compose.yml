version: '3.7'

services:
        users:
         build:
          context: ./services/users
          dockerfile: Dockerfile
         ports:
          - 5001:5000
         expose:
          - 5000
         volumes:
          - './services/users:/usr/src/app'
         environment:
          - FLASK_APP=project/__init__.py
          - FLASK_ENV=development
          - APP_SETTINGS=project.config.DevelopmentConfig
          - DATABASE_URL=postgres://postgres:postgres@users-db:5432/users_dev
          - DATABASE_TEST_URL=postgres://postgres:postgres@users-db:5432/users_test
          - SECRET_KEY=my_precious
         depends_on:
          - users-db
        users-db:
         build:
          context: ./services/users/project/db
          dockerfile: Dockerfile
         ports:
          - 5345:5342
         expose:
          - 5342
         environment:
          - POSTGRES_USER=postgres
          - POSTGRES_PASSWORD=postgres
        nginx:
         build:
          context: ./services/nginx
          dockerfile: Dockerfile
         restart: always
         ports: 
          - 80:80
         depends_on:
          - users
          - client
        client:
         build:
          context: ./services/client
          dockerfile: Dockerfile
         ports:
          - 3007:3000
         expose:
          - 3000
         volumes:
          - './services/client:/usr/src/app'
          - '/usr/src/app/node_modules'
         environment:
          - NODE_ENV=development
          - REACT_APP_USERS_SERVICE_URL=${REACT_APP_USERS_SERVICE_URL}
         depends_on:
          - users
           
           
